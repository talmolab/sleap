
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>sleap.gui.widgets.video &#8212; SLEAP  documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for sleap.gui.widgets.video</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for showing and manipulating skeleton instances within a video.</span>

<span class="sd">All interactions should go through `QtVideoPlayer`.</span>

<span class="sd">Example usage:</span>
<span class="sd">    &gt;&gt;&gt; my_video = Video(...)</span>
<span class="sd">    &gt;&gt;&gt; my_instance = Instance(...)</span>

<span class="sd">    &gt;&gt;&gt; vp = QtVideoPlayer(video=my_video)</span>
<span class="sd">    &gt;&gt;&gt; vp.addInstance(instance=my_instance, color=(r, g, b))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>


<span class="c1"># FORCE_REQUESTS controls whether we emit a signal to process frame requests</span>
<span class="c1"># if we haven&#39;t processed any for a certain amount of time.</span>
<span class="c1"># Usually the processing gets triggered by a timer but if the user is (e.g.)</span>
<span class="c1"># dragging the mouse, the timer doesn&#39;t trigger.</span>
<span class="c1"># FORCE_REQUESTS lets us update the frames in real time, assuming the load time</span>
<span class="c1"># is short enough to do that.</span>

<span class="n">FORCE_REQUESTS</span> <span class="o">=</span> <span class="kc">True</span>


<span class="kn">from</span> <span class="nn">PySide2</span> <span class="kn">import</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
    <span class="n">QGraphicsView</span><span class="p">,</span>
    <span class="n">QGraphicsScene</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">PySide2.QtGui</span> <span class="kn">import</span> <span class="n">QImage</span><span class="p">,</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">QPainter</span><span class="p">,</span> <span class="n">QPainterPath</span><span class="p">,</span> <span class="n">QTransform</span>
<span class="kn">from</span> <span class="nn">PySide2.QtGui</span> <span class="kn">import</span> <span class="n">QPen</span><span class="p">,</span> <span class="n">QBrush</span><span class="p">,</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QPolygonF</span>
<span class="kn">from</span> <span class="nn">PySide2.QtGui</span> <span class="kn">import</span> <span class="n">QKeyEvent</span><span class="p">,</span> <span class="n">QMouseEvent</span><span class="p">,</span> <span class="n">QKeySequence</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QRectF</span><span class="p">,</span> <span class="n">QPointF</span><span class="p">,</span> <span class="n">QMarginsF</span><span class="p">,</span> <span class="n">QLineF</span>

<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QGraphicsItem</span><span class="p">,</span> <span class="n">QGraphicsObject</span>

<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QGraphicsEllipseItem</span><span class="p">,</span>
    <span class="n">QGraphicsTextItem</span><span class="p">,</span>
    <span class="n">QGraphicsRectItem</span><span class="p">,</span>
    <span class="n">QGraphicsPolygonItem</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">sleap.prefs</span> <span class="kn">import</span> <span class="n">prefs</span>
<span class="kn">from</span> <span class="nn">sleap.skeleton</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">sleap.instance</span> <span class="kn">import</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">sleap.io.video</span> <span class="kn">import</span> <span class="n">Video</span>
<span class="kn">from</span> <span class="nn">sleap.gui.widgets.slider</span> <span class="kn">import</span> <span class="n">VideoSlider</span>
<span class="kn">from</span> <span class="nn">sleap.gui.state</span> <span class="kn">import</span> <span class="n">GuiState</span>
<span class="kn">from</span> <span class="nn">sleap.gui.color</span> <span class="kn">import</span> <span class="n">ColorManager</span>
<span class="kn">from</span> <span class="nn">sleap.gui.shortcuts</span> <span class="kn">import</span> <span class="n">Shortcuts</span>

<span class="kn">import</span> <span class="nn">qimage2ndarray</span>


<div class="viewcode-block" id="LoadImageWorker"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.LoadImageWorker">[docs]</a><span class="k">class</span> <span class="nc">LoadImageWorker</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object to load video frames in background thread.</span>

<span class="sd">    Requests to load a frame image are sent by calling the `request` method with</span>
<span class="sd">    the frame idx; the video attribute should already be set to the correct</span>
<span class="sd">    video.</span>

<span class="sd">    These requests are added to a FILO queue polled by the `doProcessing`</span>
<span class="sd">    method, called whenever there&#39;s time during the Qt event loop.</span>
<span class="sd">    (It&#39;s also added to the event queue if it hasn&#39;t been called for a while</span>
<span class="sd">    and we get a request, since the timer doesn&#39;t seem to emit events if the</span>
<span class="sd">    user has been holding down the mouse for a while.)</span>

<span class="sd">    The actual frame loading is wrapped with a mutex lock so that we only load</span>
<span class="sd">    a single frame at a time; this helps us not get a bunch of older frame</span>
<span class="sd">    requests running concurrently.</span>

<span class="sd">    Once the frame loads, the `QImage` is sent via the `result` signal.</span>
<span class="sd">    (Qt handles the cross-thread communication if we use signals.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">QImage</span><span class="p">)</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

    <span class="n">load_queue</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_last_process_time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_force_request_wait_time</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_recent_load_times</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LoadImageWorker</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_processing_mutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recent_load_times</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Connect signal to processing function so that we can add processing</span>
        <span class="c1"># event to event queue from the request handler.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doProcessing</span><span class="p">)</span>

        <span class="c1"># Start timer which will trigger processing events when we&#39;re free</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doProcessing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doProcessing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_process_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_queue</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Use a mutex lock to ensure that we&#39;re only loading one frame at a time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processing_mutex</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

        <span class="c1"># Maybe we had to wait to acquire the lock, so make sure there are still</span>
        <span class="c1"># frames to load</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_queue</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get the most recent request and clear all the others, since there&#39;s no</span>
        <span class="c1"># reason to load frames for older requests</span>
        <span class="n">frame_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_queue</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_queue</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># Get image data</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_recent_load_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

            <span class="c1"># Set the time to wait before forcing a load request to a little</span>
            <span class="c1"># longer than the average time it recently took to load a frame</span>
            <span class="n">avg_load_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recent_load_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recent_load_times</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_force_request_wait_time</span> <span class="o">=</span> <span class="n">avg_load_time</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Release the lock so other threads can start processing frame requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processing_mutex</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Convert ndarray to QImage</span>
            <span class="n">qimage</span> <span class="o">=</span> <span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">array2qimage</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

            <span class="c1"># Emit result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">qimage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">):</span>
        <span class="c1"># Add request to the queue so that we can just process the most recent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">)</span>

        <span class="c1"># If we haven&#39;t processed a request for a certain amount of time,</span>
        <span class="c1"># then trigger a processing event now. This helps when the user has been</span>
        <span class="c1"># continuously changing frames for a while (i.e., dragging on seekbar</span>
        <span class="c1"># or holding down arrow key).</span>

        <span class="n">since_last</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_process_time</span>

        <span class="k">if</span> <span class="n">FORCE_REQUESTS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">since_last</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_request_wait_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_process_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>


<div class="viewcode-block" id="QtVideoPlayer"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer">[docs]</a><span class="k">class</span> <span class="nc">QtVideoPlayer</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main QWidget for displaying video with skeleton instances.</span>

<span class="sd">    Signals:</span>
<span class="sd">        * changedPlot: Emitted whenever the plot is redrawn</span>

<span class="sd">    Attributes:</span>
<span class="sd">        video: The :class:`Video` to display</span>
<span class="sd">        color_manager: A :class:`ColorManager` object which determines</span>
<span class="sd">            which color to show the instances.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">changedPlot</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video</span><span class="p">:</span> <span class="n">Video</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtVideoPlayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shift_key_down</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span> <span class="o">=</span> <span class="n">color_manager</span> <span class="ow">or</span> <span class="n">ColorManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="n">GuiState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortcuts</span> <span class="o">=</span> <span class="n">Shortcuts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">GraphicsView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span> <span class="o">=</span> <span class="n">VideoSlider</span><span class="p">(</span><span class="n">color_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">keyPress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">keyRelease</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyReleaseEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">heightUpdated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">refresh</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_register_shortcuts</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_contextual_menu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_menu_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_menu_enabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="c1"># Make worker thread to load images in the background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader_thread</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_image_loader</span> <span class="o">=</span> <span class="n">LoadImageWorker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_image_loader</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loader_thread</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Connect signal so that image will be shown after it&#39;s loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_image_loader</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">qimage</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">qimage</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_selection_state</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;frame_range&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;has_frame_range&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_selection_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">idx</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">idx</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">selectInstance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;show labels&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;show edges&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_video</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setFitZoom</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Call cleanup method when application exits to end worker thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroyed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">)</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_video</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader_thread</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader_thread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_load_and_show_requested_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">):</span>
        <span class="c1"># Get image data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Convert ndarray to QImage</span>
            <span class="n">qimage</span> <span class="o">=</span> <span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">array2qimage</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

            <span class="c1"># Display image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">qimage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_shortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shortcut_triggers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">frame_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">enable_shift_selection</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">:</span>
                <span class="n">before_frame_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
                <span class="c1"># only use shift for selection if not part of shortcut</span>
                <span class="k">if</span> <span class="n">enable_shift_selection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_key_down</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_select_on_possible_frame_movement</span><span class="p">(</span><span class="n">before_frame_idx</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_shortcut</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="c1"># Register shortcut and have it trigger frame_step action</span>
            <span class="n">shortcut</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortcuts</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">shortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">step</span><span class="p">:</span> <span class="n">frame_step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shortcut_triggers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">shortcut</span>

            <span class="c1"># If shift isn&#39;t part of shortcut, then we want to allow</span>
            <span class="c1"># shift + shortcut for movement + selection.</span>

            <span class="c1"># We use hack of convert to/from the string representation of</span>
            <span class="c1"># shortcut to determine if shift is in shortcut and to add it.</span>
            <span class="n">no_shift</span> <span class="o">=</span> <span class="s2">&quot;Shift&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shortcut</span><span class="o">.</span><span class="n">key</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">no_shift</span><span class="p">:</span>
                <span class="c1"># Make shortcut + shift key sequence</span>
                <span class="n">shortcut_seq_with_shift</span> <span class="o">=</span> <span class="n">QKeySequence</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Shift+</span><span class="si">{</span><span class="n">shortcut</span><span class="o">.</span><span class="n">key</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Register this new shortcut, enabling shift selection</span>
                <span class="n">shortcut</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">shortcut_seq_with_shift</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="n">shortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">step</span><span class="p">:</span> <span class="n">frame_step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shortcut_triggers</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_shift_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shortcut</span>

        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame next&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame prev&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame next medium step&quot;</span><span class="p">,</span> <span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;medium step size&quot;</span><span class="p">])</span>
        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame prev medium step&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;medium step size&quot;</span><span class="p">])</span>
        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame next large step&quot;</span><span class="p">,</span> <span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;large step size&quot;</span><span class="p">])</span>
        <span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;frame prev large step&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;large step size&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">setSeekbarSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_contextual_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="p">:</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_menu_enabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scene_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Add Instance:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">init_method</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">))</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Average&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span>
                <span class="n">init_method</span><span class="o">=</span><span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">scene_pos</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Force Directed&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span>
                <span class="n">init_method</span><span class="o">=</span><span class="s2">&quot;force_directed&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">scene_pos</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Copy Prior Frame&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">init_method</span><span class="o">=</span><span class="s2">&quot;prior_frame&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;Random&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">init_method</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">scene_pos</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">where</span><span class="p">))</span>

<div class="viewcode-block" id="QtVideoPlayer.load_video"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.load_video">[docs]</a>    <span class="k">def</span> <span class="nf">load_video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video</span><span class="p">:</span> <span class="n">Video</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load video into viewer.</span>

<span class="sd">        Args:</span>
<span class="sd">            video: the :class:`Video` to display</span>
<span class="sd">            plot: If True, plot the video frame. Otherwise, just load the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">video</span>

        <span class="c1"># Is this necessary?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setSceneRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">video</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">video</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">last_frame_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtVideoPlayer.reset"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset viewer by removing all video data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of all `QtInstance` objects in view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">instances</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selectable_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of selectable `QtInstance` objects in view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">selectable_instances</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">predicted_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of predicted `QtInstance` objects in view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">predicted_instances</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns `QGraphicsScene` for viewer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">scene</span>

<div class="viewcode-block" id="QtVideoPlayer.addInstance"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.addInstance">[docs]</a>    <span class="k">def</span> <span class="nf">addInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a skeleton instance to the video.</span>

<span class="sd">        Args:</span>
<span class="sd">            instance: this can be either a `QtInstance` or an `Instance`</span>

<span class="sd">            Any other named args are passed along if/when creating QtInstance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if instance is an Instance (or subclass of Instance)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="n">Instance</span><span class="p">):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">QtInstance</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span> <span class="n">player</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">!=</span> <span class="n">QtInstance</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

        <span class="c1"># connect signal so we can adjust QtNodeLabel positions after zoom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">updatedViewer</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.plot"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the actual plotting of the video frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="c1"># Clear exiting objects before drawing instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Emit signal for the instances to be drawn for this frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changedPlot</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">])</span>

        <span class="c1"># Request for the image to load and be shown for this frame</span>
        <span class="c1"># (note that we&#39;re calling method directly rather than connecting</span>
        <span class="c1"># the method to a signal because Qt was holding onto the signal events</span>
        <span class="c1"># for too long before they were received by the loader).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_image_loader</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_image_loader</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.showLabels"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.showLabels">[docs]</a>    <span class="k">def</span> <span class="nf">showLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Show/hide node labels for all instances in viewer.</span>

<span class="sd">        Args:</span>
<span class="sd">            show: Show if True, hide otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectable_instances</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">showLabels</span><span class="p">(</span><span class="n">show</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.showEdges"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.showEdges">[docs]</a>    <span class="k">def</span> <span class="nf">showEdges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Show/hide node edges for all instances in viewer.</span>

<span class="sd">        Args:</span>
<span class="sd">            show: Show if True, hide otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectable_instances</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">showEdges</span><span class="p">(</span><span class="n">show</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">highlightPredictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">highlight_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_instances</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">highlight</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">highlight_text</span> <span class="o">=</span> <span class="n">highlight_text</span>

<div class="viewcode-block" id="QtVideoPlayer.zoomToFit"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.zoomToFit">[docs]</a>    <span class="k">def</span> <span class="nf">zoomToFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Zoom view to fit all instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zoom_rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">instancesBoundingRect</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">zoom_rect</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">zoomToRect</span><span class="p">(</span><span class="n">zoom_rect</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.setFitZoom"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.setFitZoom">[docs]</a>    <span class="k">def</span> <span class="nf">setFitZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Zooms or unzooms current view to fit all instances.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zoomToFit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">clearZoom</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtVideoPlayer.getVisibleRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.getVisibleRect">[docs]</a>    <span class="k">def</span> <span class="nf">getVisibleRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns `QRectF` with currently visible portion of frame image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">rect</span><span class="p">())</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtVideoPlayer.onSequenceSelect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.onSequenceSelect">[docs]</a>    <span class="k">def</span> <span class="nf">onSequenceSelect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">seq_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">on_success</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">on_each</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_failure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect a sequence of instances (through user selection).</span>

<span class="sd">        When the sequence is complete, the `on_success` callback is called.</span>
<span class="sd">        After each selection in sequence, the `on_each` callback is called</span>
<span class="sd">        (if given). If the user cancels (by unselecting without new</span>
<span class="sd">        selection), the `on_failure` callback is called (if given).</span>

<span class="sd">        Note:</span>
<span class="sd">            If successful, we call</span>
<span class="sd">            &gt;&gt;&gt; on_success(list_of_instances)</span>

<span class="sd">        Args:</span>
<span class="sd">            seq_len: Number of instances we want to collect in sequence.</span>
<span class="sd">            on_success: Callback for when user has selected desired number of</span>
<span class="sd">                instances.</span>
<span class="sd">            on_each: Callback after user selects each instance.</span>
<span class="sd">            on_failure: Callback if user cancels process before selecting</span>
<span class="sd">                enough instances.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">selected_instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getSelectionInstance</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selected_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getSelectionInstance</span><span class="p">())</span>

        <span class="c1"># Define function that will be called when user selects another instance</span>
        <span class="k">def</span> <span class="nf">handle_selection</span><span class="p">(</span>
            <span class="n">seq_len</span><span class="o">=</span><span class="n">seq_len</span><span class="p">,</span>
            <span class="n">selected_instances</span><span class="o">=</span><span class="n">selected_instances</span><span class="p">,</span>
            <span class="n">on_success</span><span class="o">=</span><span class="n">on_success</span><span class="p">,</span>
            <span class="n">on_each</span><span class="o">=</span><span class="n">on_each</span><span class="p">,</span>
            <span class="n">on_failure</span><span class="o">=</span><span class="n">on_failure</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># Get the index of the currently selected instance</span>
            <span class="n">new_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getSelectionInstance</span><span class="p">()</span>
            <span class="c1"># If something is selected, add it to the list</span>
            <span class="k">if</span> <span class="n">new_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">selected_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_instance</span><span class="p">)</span>
            <span class="c1"># If nothing is selected, then remove this handler and trigger on_failure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">updatedSelection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">handle_selection</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">on_failure</span><span class="p">):</span>
                    <span class="n">on_failure</span><span class="p">(</span><span class="n">selected_instances</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># If we have all the instances we want in our sequence, we&#39;re done</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_instances</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">seq_len</span><span class="p">:</span>
                <span class="c1"># remove this handler</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">updatedSelection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">handle_selection</span><span class="p">)</span>
                <span class="c1"># trigger success, passing the list of selected instances</span>
                <span class="n">on_success</span><span class="p">(</span><span class="n">selected_instances</span><span class="p">)</span>
            <span class="c1"># If we&#39;re still in progress...</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">on_each</span><span class="p">):</span>
                    <span class="n">on_each</span><span class="p">(</span><span class="n">selected_instances</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">updatedSelection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handle_selection</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">on_each</span><span class="p">):</span>
            <span class="n">on_each</span><span class="p">(</span><span class="n">selected_instances</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_signal_once</span><span class="p">(</span><span class="n">signal</span><span class="p">:</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects callback for next occurrence of signal.</span>

<span class="sd">        Args:</span>
<span class="sd">            signal: The signal on which we want callback to be called.</span>
<span class="sd">            callback: The function that should be called just once, the next</span>
<span class="sd">                time the signal is emitted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">call_once</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">call_once</span><span class="p">)</span>
            <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="n">signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">call_once</span><span class="p">)</span>

<div class="viewcode-block" id="QtVideoPlayer.onPointSelection"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.onPointSelection">[docs]</a>    <span class="k">def</span> <span class="nf">onPointSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts mode for user to click point, callback called when finished.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback: The function called after user clicks point, should</span>
<span class="sd">                take x and y as arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">=</span> <span class="s2">&quot;point&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">pointSelected</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.onAreaSelection"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.onAreaSelection">[docs]</a>    <span class="k">def</span> <span class="nf">onAreaSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts mode for user to select area, callback called when finished.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback: The function called after user clicks point, should</span>
<span class="sd">                take x0, y0, x1, y1 as arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">=</span> <span class="s2">&quot;area&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">areaSelected</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtVideoPlayer.keyReleaseEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.keyReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QKeyEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom event handler, tracks when user releases modifier (shift) key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_Shift</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shift_key_down</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtVideoPlayer.keyPressEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtVideoPlayer.keyPressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QKeyEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom event handler, allows navigation and selection within view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frame_t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_Shift</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shift_key_down</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_Home</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_End</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">frames</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_Escape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_K</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">getEndContiguousMark</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_J</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">getStartContiguousMark</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">Key_QuoteLeft</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">increment_in_list</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectable_instances</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">128</span> <span class="ow">and</span> <span class="nb">chr</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">())</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="c1"># decrement by 1 since instances are 0-indexed</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectable_instances</span><span class="p">):</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectable_instances</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instance</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>  <span class="c1"># Kicks the event up to parent</span>

        <span class="c1"># If user is holding down shift and action resulted in moving to another frame</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_key_down</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_on_possible_frame_movement</span><span class="p">(</span><span class="n">frame_t0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_select_on_possible_frame_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before_frame_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">before_frame_idx</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]:</span>
            <span class="c1"># If there&#39;s no select, start seekbar selection at frame before action</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">getSelection</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">startSelection</span><span class="p">(</span><span class="n">before_frame_idx</span><span class="p">)</span>
            <span class="c1"># Set endpoint to frame after action</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">endSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphicsView"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView">[docs]</a><span class="k">class</span> <span class="nc">GraphicsView</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom `QGraphicsView` used by `QtVideoPlayer`.</span>

<span class="sd">    This contains elements for display of video and event handlers for zoom</span>
<span class="sd">    and selection of instances in view.</span>

<span class="sd">    Signals:</span>
<span class="sd">        * updatedViewer: Emitted after update to view (e.g., zoom).</span>
<span class="sd">            Used internally so we know when to update points for each instance.</span>
<span class="sd">        * updatedSelection: Emitted after the user has (un)selected an instance.</span>
<span class="sd">        * instanceDoubleClicked: Emitted after an instance is double-clicked.</span>
<span class="sd">            Passes the :class:`Instance` that was double-clicked.</span>
<span class="sd">        * areaSelected: Emitted after user selects an area when in &quot;area&quot;</span>
<span class="sd">            click mode. Passes x0, y0, x1, y1 for selected box coordinates.</span>
<span class="sd">        * pointSelected: Emitted after user clicks a point (in &quot;point&quot; click</span>
<span class="sd">            mode.) Passes x, y coordinates of point.</span>
<span class="sd">        * leftMouseButtonPressed: Emitted by event handler.</span>
<span class="sd">        * rightMouseButtonPressed: Emitted by event handler.</span>
<span class="sd">        * leftMouseButtonReleased: Emitted by event handler.</span>
<span class="sd">        * rightMouseButtonReleased: Emitted by event handler.</span>
<span class="sd">        * leftMouseButtonDoubleClicked: Emitted by event handler.</span>
<span class="sd">        * rightMouseButtonDoubleClicked: Emitted by event handler.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">updatedViewer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">updatedSelection</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">instanceDoubleClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">Instance</span><span class="p">,</span> <span class="n">QMouseEvent</span><span class="p">)</span>
    <span class="n">areaSelected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">pointSelected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">leftMouseButtonPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">rightMouseButtonPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">leftMouseButtonReleased</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">rightMouseButtonReleased</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">leftMouseButtonDoubleClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">rightMouseButtonDoubleClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">player</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; https://github.com/marcel-goldschen-ohm/PyQtImageViewer/blob/master/QtImageViewer.py &quot;&quot;&quot;</span>
        <span class="n">QGraphicsView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="n">GuiState</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">QGraphicsScene</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setBackgroundBrush</span><span class="p">(</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">black</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aspectRatioMode</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canZoom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canPan</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_zoom</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">anchor_mode</span> <span class="o">=</span> <span class="n">QGraphicsView</span><span class="o">.</span><span class="n">AnchorUnderMouse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTransformationAnchor</span><span class="p">(</span><span class="n">anchor_mode</span><span class="p">)</span>

<div class="viewcode-block" id="GraphicsView.hasImage"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.hasImage">[docs]</a>    <span class="k">def</span> <span class="nf">hasImage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Returns whether or not the scene contains an image pixmap.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="GraphicsView.clear"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clears the displayed frame from the scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span><span class="p">:</span>
            <span class="c1"># get the pixmap currently shown</span>
            <span class="n">pixmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span><span class="o">.</span><span class="n">pixmap</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span><span class="p">:</span>
            <span class="c1"># add the pixmap back</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_pixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a pixmap to the scene and transforms it to midpoint coordinates.&quot;&quot;&quot;</span>
        <span class="n">pixmap_graphics_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="n">pixmap_graphics_item</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
        <span class="n">transform</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">pixmap_graphics_item</span><span class="o">.</span><span class="n">setTransform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pixmap_graphics_item</span>

<div class="viewcode-block" id="GraphicsView.setImage"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.setImage">[docs]</a>    <span class="k">def</span> <span class="nf">setImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">QImage</span><span class="p">,</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the scene&#39;s current image pixmap to the input QImage or QPixmap.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The QPixmap or QImage to display.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the input image is not QImage or QPixmap</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1"># Convert numpy array of frame image to QImage</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">array2qimage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">is</span> <span class="n">QPixmap</span><span class="p">:</span>
            <span class="n">pixmap</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">is</span> <span class="n">QImage</span><span class="p">:</span>
            <span class="n">pixmap</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;ImageViewer.setImage: Argument must be a QImage or QPixmap.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasImage</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_pixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>

            <span class="c1"># Ensure that image is behind everything else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pixmapHandle</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Set scene size to image size, translated to midpoint coordinates.</span>
        <span class="c1"># (If we don&#39;t translate the rect, the image will be cut off by</span>
        <span class="c1"># 1/2 pixel at the top left and have a 1/2 pixel border at bottom right)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">QRectF</span><span class="p">(</span><span class="n">pixmap</span><span class="o">.</span><span class="n">rect</span><span class="p">())</span>
        <span class="n">rect</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSceneRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateViewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="GraphicsView.updateViewer"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.updateViewer">[docs]</a>    <span class="k">def</span> <span class="nf">updateViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Apply current zoom. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasImage</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">base_w_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="n">base_h_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneRect</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">base_scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_w_scale</span><span class="p">,</span> <span class="n">base_h_scale</span><span class="p">)</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="n">QTransform</span><span class="p">()</span>
        <span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">base_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span><span class="p">,</span> <span class="n">base_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTransform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatedViewer</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;QtInstance&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of instances.</span>

<span class="sd">        Order should match the order in which instances were added to scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">predicted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">predicted_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;QtInstance&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of predicted instances.</span>

<span class="sd">        Order should match the order in which instances were added to scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">predicted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selectable_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;QtInstance&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of instances which user can select.</span>

<span class="sd">        Order should match the order in which instances were added to scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">selectable</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;QtInstance&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all `QtInstance` objects in scene.</span>

<span class="sd">        Order should match the order in which instances were added to scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scene_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SortOrder</span><span class="o">.</span><span class="n">AscendingOrder</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">QtInstance</span><span class="p">),</span> <span class="n">scene_items</span><span class="p">))</span>

<div class="viewcode-block" id="GraphicsView.selectInstance"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.selectInstance">[docs]</a>    <span class="k">def</span> <span class="nf">selectInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Instance</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a particular instance in view.</span>

<span class="sd">        Args:</span>
<span class="sd">            select: Either `Instance` or index of instance in view.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span><span class="p">):</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">select</span> <span class="o">==</span> <span class="n">idx</span> <span class="ow">or</span> <span class="n">select</span> <span class="o">==</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatedSelection</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="GraphicsView.getSelectionIndex"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.getSelectionIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectionIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Returns the index of the currently selected instance.</span>
<span class="sd">        If no instance selected, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">selected</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="GraphicsView.getSelectionInstance"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.getSelectionInstance">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectionInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Instance</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Returns the currently selected instance.</span>
<span class="sd">        If no instance selected, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">selected</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">instance</span></div>

<div class="viewcode-block" id="GraphicsView.getTopInstanceAt"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.getTopInstanceAt">[docs]</a>    <span class="k">def</span> <span class="nf">getTopInstanceAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenePos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Instance</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns topmost instance at position in scene.&quot;&quot;&quot;</span>
        <span class="c1"># Get all items at scenePos</span>
        <span class="n">clicked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">scenePos</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">IntersectsItemBoundingRect</span><span class="p">)</span>

        <span class="c1"># Filter by selectable instances</span>
        <span class="k">def</span> <span class="nf">is_selectable</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="n">QtInstance</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">selectable</span>

        <span class="n">clicked</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_selectable</span><span class="p">,</span> <span class="n">clicked</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clicked</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">clicked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">instance</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="GraphicsView.resizeEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.resizeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Maintain current zoom on resize.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateViewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="GraphicsView.mousePressEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Start mouse pan or zoom mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenePos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="c1"># keep track of click location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_down_pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="c1"># behavior depends on which button is pressed</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">==</span> <span class="s2">&quot;area&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">RubberBandDrag</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">==</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">NoDrag</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">canPan</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">ScrollHandDrag</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canZoom</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_zoom</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">RubberBandDrag</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">leftMouseButtonPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightMouseButtonPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="n">QGraphicsView</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphicsView.mouseReleaseEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Stop mouse pan or zoom mode (apply zoom if valid).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QGraphicsView</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="n">scenePos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>

        <span class="c1"># check if mouse moved during click</span>
        <span class="n">has_moved</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_down_pos</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_zoom</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_zoom</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">zoom_rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">selectionArea</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setSelectionArea</span><span class="p">(</span><span class="n">QPainterPath</span><span class="p">())</span>  <span class="c1"># clear selection</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zoomToRect</span><span class="p">(</span><span class="n">zoom_rect</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="c1"># Check if this was just a tap (not a drag)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_moved</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTopInstanceAt</span><span class="p">(</span><span class="n">scenePos</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">==</span> <span class="s2">&quot;area&quot;</span><span class="p">:</span>
                <span class="c1"># Check if user was selecting rectangular area</span>
                <span class="n">selection_rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">selectionArea</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">areaSelected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
                    <span class="n">selection_rect</span><span class="o">.</span><span class="n">left</span><span class="p">(),</span>
                    <span class="n">selection_rect</span><span class="o">.</span><span class="n">top</span><span class="p">(),</span>
                    <span class="n">selection_rect</span><span class="o">.</span><span class="n">right</span><span class="p">(),</span>
                    <span class="n">selection_rect</span><span class="o">.</span><span class="n">bottom</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">==</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pointSelected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">click_mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unsetCursor</span><span class="p">()</span>

            <span class="c1"># finish drag</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">NoDrag</span><span class="p">)</span>
            <span class="c1"># pass along event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leftMouseButtonReleased</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setDragMode</span><span class="p">(</span><span class="n">QGraphicsView</span><span class="o">.</span><span class="n">NoDrag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightMouseButtonReleased</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span></div>

<div class="viewcode-block" id="GraphicsView.mouseMoveEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># re-enable contextual menu if necessary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">is_menu_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">QGraphicsView</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphicsView.zoomToRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.zoomToRect">[docs]</a>    <span class="k">def</span> <span class="nf">zoomToRect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoom_rect</span><span class="p">:</span> <span class="n">QRectF</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to zoom scene to a given rectangle.</span>

<span class="sd">        The rect can either be given relative to the current zoom</span>
<span class="sd">        (this is useful if it&#39;s the rect drawn by user) or it can be</span>
<span class="sd">        given in absolute coordinates for displayed frame.</span>

<span class="sd">        Args:</span>
<span class="sd">            zoom_rect: The `QRectF` to which we want to zoom.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">zoom_rect</span><span class="o">.</span><span class="n">isNull</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">scale_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">/</span> <span class="n">zoom_rect</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">scale_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">/</span> <span class="n">zoom_rect</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">scale_h</span><span class="p">,</span> <span class="n">scale_w</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateViewer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerOn</span><span class="p">(</span><span class="n">zoom_rect</span><span class="o">.</span><span class="n">center</span><span class="p">())</span></div>

<div class="viewcode-block" id="GraphicsView.clearZoom"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.clearZoom">[docs]</a>    <span class="k">def</span> <span class="nf">clearZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear zoom stack. Doesn&#39;t update display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="GraphicsView.instancesBoundingRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.instancesBoundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">instancesBoundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QRectF</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a rect which contains all displayed skeleton instances.</span>

<span class="sd">        Args:</span>
<span class="sd">            margin: Margin for padding the rect.</span>
<span class="sd">        Returns:</span>
<span class="sd">            The `QRectF` which contains the skeleton instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">QRectF</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">united</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">marginsAdded</span><span class="p">(</span><span class="n">QMarginsF</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">margin</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rect</span></div>

<div class="viewcode-block" id="GraphicsView.mouseDoubleClickEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.mouseDoubleClickEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseDoubleClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QMouseEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Custom event handler, clears zoom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenePos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canZoom</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clearZoom</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateViewer</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">leftMouseButtonDoubleClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightMouseButtonDoubleClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">scenePos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">scenePos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="n">QGraphicsView</span><span class="o">.</span><span class="n">mouseDoubleClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphicsView.wheelEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.wheelEvent">[docs]</a>    <span class="k">def</span> <span class="nf">wheelEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Custom event handler. Zoom in/out based on scroll wheel change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># zoom on wheel when no mouse buttons are pressed</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">buttons</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoButton</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">angleDelta</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.9</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomFactor</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateViewer</span><span class="p">()</span>

        <span class="c1"># Trigger wheelEvent for all child elements. This is a bit of a hack.</span>
        <span class="c1"># We can&#39;t use QGraphicsView.wheelEvent(self, event) since that will scroll view.</span>
        <span class="c1"># We want to trigger for all children, since wheelEvent should continue rotating</span>
        <span class="c1"># an skeleton even if the skeleton node/node label is no longer under the cursor.</span>
        <span class="c1"># Note that children expect a QGraphicsSceneWheelEvent event, which is why we&#39;re</span>
        <span class="c1"># explicitly ignoring TypeErrors. Everything seems to work fine since we don&#39;t</span>
        <span class="c1"># care about the mouse position; if we did, we&#39;d need to map pos to scene.</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">wheelEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="GraphicsView.keyPressEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.keyPressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom event hander, disables default QGraphicsView behavior.&quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>  <span class="c1"># Kicks the event up to parent</span></div>

<div class="viewcode-block" id="GraphicsView.keyReleaseEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.GraphicsView.keyReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">keyReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom event hander, disables default QGraphicsView behavior.&quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>  <span class="c1"># Kicks the event up to parent</span></div></div>


<div class="viewcode-block" id="QtNodeLabel"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel">[docs]</a><span class="k">class</span> <span class="nc">QtNodeLabel</span><span class="p">(</span><span class="n">QGraphicsTextItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QGraphicsTextItem to handle display of node text label.</span>

<span class="sd">    Args:</span>
<span class="sd">        node: The `QtNode` to which this label is attached.</span>
<span class="sd">        parent: The `QtInstance` which will contain this item.</span>
<span class="sd">        predicted: Whether this is for a predicted point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">QGraphicsObject</span><span class="p">,</span>
        <span class="n">predicted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="n">predicted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtNodeLabel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="o">.</span><span class="n">setPixelSize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="p">)</span>

        <span class="c1"># set color to match node color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">pen</span><span class="p">()</span><span class="o">.</span><span class="n">color</span><span class="p">())</span>
        <span class="c1"># don&#39;t rescale when view is scaled (i.e., zoom)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIgnoresTransformations</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">adjustStyle</span><span class="p">()</span>

<div class="viewcode-block" id="QtNodeLabel.adjustPos"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.adjustPos">[docs]</a>    <span class="k">def</span> <span class="nf">adjustPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update the position of the label based on the position of the node.</span>

<span class="sd">        Args:</span>
<span class="sd">            Accepts arbitrary arguments so we can connect to various signals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_x</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_y</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>

        <span class="c1"># Calculate position for label within the largest arc made by edges.</span>
        <span class="n">shift_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
            <span class="n">edge_angles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">edge</span><span class="o">.</span><span class="n">angle_to</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">edges</span><span class="p">])</span>

            <span class="n">edge_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Calculate size and bisector for each arc between adjacent edges</span>
            <span class="n">edge_arcs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">edge_angles</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">edge_angles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">edge_angles</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">edge_angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_angles</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">max_arc</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">edge_arcs</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">shift_angle</span> <span class="o">=</span> <span class="n">max_arc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># this is the angle of the bisector</span>
            <span class="n">shift_angle</span> <span class="o">%=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>

        <span class="c1"># Use the _shift_factor to control how the label is positioned</span>
        <span class="c1"># relative to the node.</span>
        <span class="c1"># Shift factor of -1 means we shift label up/left by its height/width.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shift_factor_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">shift_angle</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shift_factor_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">shift_angle</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>

        <span class="c1"># Since item doesn&#39;t scale when view is transformed (i.e., zoom)</span>
        <span class="c1"># we need to calculate bounding size in view manually.</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>

        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Get the current scaling for the view and apply this to size of label</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">views</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">view</span><span class="o">.</span><span class="n">viewportTransform</span><span class="p">()</span><span class="o">.</span><span class="n">m11</span><span class="p">()</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">view</span><span class="o">.</span><span class="n">viewportTransform</span><span class="p">()</span><span class="o">.</span><span class="n">m22</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_factor_x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_factor_y</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Now apply these changes to the visual display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustStyle</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtNodeLabel.adjustStyle"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.adjustStyle">[docs]</a>    <span class="k">def</span> <span class="nf">adjustStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update visual display of the label and its node.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">complete_color</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">QColor</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">159</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">complete</span> <span class="k">else</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">232</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="p">)</span>
            <span class="c1"># self.setDefaultTextColor(self.node.pen().color())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">complete_color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">complete_color</span><span class="p">)</span>  <span class="c1"># greenish</span>
            <span class="c1"># FIXME: Adjust style of node here as well?</span>
            <span class="c1"># self.node.setBrush(complete_color)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">complete_color</span><span class="p">)</span>  <span class="c1"># redish</span></div>

<div class="viewcode-block" id="QtNodeLabel.boundingRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required by Qt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">QtNodeLabel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtNodeLabel.paint"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required by Qt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtNodeLabel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtNodeLabel.mousePressEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass events along so that clicking label is like clicking node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtNodeLabel.mouseMoveEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass events along so that clicking label is like clicking node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtNodeLabel.mouseReleaseEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass events along so that clicking label is like clicking node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsetCursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtNodeLabel.wheelEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNodeLabel.wheelEvent">[docs]</a>    <span class="k">def</span> <span class="nf">wheelEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pass events along so that clicking label is like clicking node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">wheelEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QtNode"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode">[docs]</a><span class="k">class</span> <span class="nc">QtNode</span><span class="p">(</span><span class="n">QGraphicsEllipseItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QGraphicsEllipseItem to handle display of skeleton instance node.</span>

<span class="sd">    Args:</span>
<span class="sd">        parent: The `QtInstance` which will contain this item.</span>
<span class="sd">        node: The :class:`Node` corresponding to this visual node.</span>
<span class="sd">        point: The :class:`Point` where this node is located.</span>
<span class="sd">            Note that this is a mutable object so we&#39;re able to directly access</span>
<span class="sd">            the very same `Point` object that&#39;s defined outside our class.</span>
<span class="sd">        radius: Radius of the visual node item.</span>
<span class="sd">        predicted: Whether this point is predicted.</span>
<span class="sd">        show_non_visible: Whether to show points where `visible` is False.</span>
<span class="sd">        callbacks: List of functions to call after we update to the `Point`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">QGraphicsObject</span><span class="p">,</span>
        <span class="n">player</span><span class="p">:</span> <span class="n">QtVideoPlayer</span><span class="p">,</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">predicted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_non_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point</span> <span class="o">=</span> <span class="n">point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">color_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_color</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">instance</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="n">predicted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span> <span class="o">=</span> <span class="n">show_non_visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">callbacks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">QtNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIgnoresTransformations</span><span class="p">)</span>

        <span class="n">line_color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>

        <span class="n">pen_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_pen_width</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">instance</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIsMovable</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">line_color</span><span class="p">,</span> <span class="n">pen_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pen_missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">brush</span> <span class="o">=</span> <span class="n">QBrush</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brush_missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brush</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIsMovable</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">line_color</span><span class="p">,</span> <span class="n">pen_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span>
                <span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># https://stackoverflow.com/questions/13120486/adjusting-qpen-thickness-when-scaling-qgraphicsview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pen_missing</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">line_color</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pen_missing</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brush</span> <span class="o">=</span> <span class="n">QBrush</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brush_missing</span> <span class="o">=</span> <span class="n">QBrush</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePoint</span><span class="p">(</span><span class="n">user_change</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="QtNode.calls"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.calls">[docs]</a>    <span class="k">def</span> <span class="nf">calls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to call all callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
                <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">visible_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">zoomFactor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">zoomFactor</span><span class="p">)</span>

<div class="viewcode-block" id="QtNode.updatePoint"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.updatePoint">[docs]</a>    <span class="k">def</span> <span class="nf">updatePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_change</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to update data for node/edge when node position is manipulated.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_change: Whether this being called because of change by user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="n">user_change</span> <span class="ow">and</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">setPointLocations</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_default</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brush</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_missing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brush_missing</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setRect</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">updateEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># trigger callbacks for other connected nodes</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">calls</span><span class="p">()</span>

        <span class="c1"># trigger callbacks for this node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">toggleVisibility</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">context</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span>
        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">setInstancePointVisibility</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_instance</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">visible</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="n">visible</span>

<div class="viewcode-block" id="QtNode.mousePressEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Custom event handler for mouse press.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do nothing if node is from predicted instance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="c1"># Alt-click to drag instance</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIsMovable</span><span class="p">)</span>
                <span class="c1"># set origin to point clicked so that we can rotate around this point</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">setTransformOriginPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="c1"># Shift-click to mark all points as complete</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">(</span><span class="n">complete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_change</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">QtNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updatePoint</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># FIXME: move to command</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
            <span class="c1"># Right-click to toggle node as missing from this instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleVisibility</span><span class="p">()</span>
            <span class="c1"># Disable contextual menu for right clicks on node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">is_menu_enabled</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># FIXME: move to command</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePoint</span><span class="p">(</span><span class="n">user_change</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="QtNode.mouseMoveEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Custom event handler for mouse move.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(event)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">QtNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePoint</span><span class="p">(</span>
                <span class="n">user_change</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>  <span class="c1"># don&#39;t count change until mouse release</span></div>

<div class="viewcode-block" id="QtNode.mouseReleaseEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.mouseReleaseEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Custom event handler for mouse release.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(event)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsetCursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIsMovable</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">(</span><span class="n">user_change</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">QtNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePoint</span><span class="p">(</span><span class="n">user_change</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="QtNode.wheelEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.wheelEvent">[docs]</a>    <span class="k">def</span> <span class="nf">wheelEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom event handler for mouse scroll wheel.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragParent</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span><span class="p">()</span> <span class="o">/</span> <span class="mi">20</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">rotation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">setRotation</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtNode.mouseDoubleClickEvent"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtNode.mouseDoubleClickEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseDoubleClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QMouseEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom event handler to emit signal on event.&quot;&quot;&quot;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scene</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">views</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">view</span><span class="o">.</span><span class="n">instanceDoubleClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentObject</span><span class="p">()</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QtEdge"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtEdge">[docs]</a><span class="k">class</span> <span class="nc">QtEdge</span><span class="p">(</span><span class="n">QGraphicsPolygonItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QGraphicsLineItem to handle display of edge between skeleton instance nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        parent: `QGraphicsObject` which will contain this item.</span>
<span class="sd">        src: The `QtNode` source node for the edge.</span>
<span class="sd">        dst: The `QtNode` destination node for the edge.</span>
<span class="sd">        show_non_visible: Whether to show &quot;non-visible&quot; nodes/edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">QGraphicsObject</span><span class="p">,</span>
        <span class="n">player</span><span class="p">:</span> <span class="n">QtVideoPlayer</span><span class="p">,</span>
        <span class="n">src</span><span class="p">:</span> <span class="n">QtNode</span><span class="p">,</span>
        <span class="n">dst</span><span class="p">:</span> <span class="n">QtNode</span><span class="p">,</span>
        <span class="n">show_non_visible</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">src</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span> <span class="o">=</span> <span class="n">show_non_visible</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">QtEdge</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">polygon</span><span class="o">=</span><span class="n">QPolygonF</span><span class="p">(),</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLine</span><span class="p">(</span>
            <span class="n">QLineF</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">edge_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_color</span><span class="p">(</span><span class="n">edge_pair</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">pen_width</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_pen_width</span><span class="p">(</span><span class="n">edge_pair</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">pen</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">),</span> <span class="n">pen_width</span><span class="p">)</span>
        <span class="n">pen</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">brush</span> <span class="o">=</span> <span class="n">QBrush</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_opacity</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line</span>

    <span class="k">def</span> <span class="nf">setLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="n">QPolygonF</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;edge style&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;wedge&quot;</span><span class="p">:</span>

            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">visible_radius</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="n">norm_a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">normalVector</span><span class="p">()</span>
            <span class="n">norm_a</span><span class="o">.</span><span class="n">setLength</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="n">norm_b</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">normalVector</span><span class="p">()</span>
            <span class="n">norm_b</span><span class="o">.</span><span class="n">setLength</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>

            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_a</span><span class="o">.</span><span class="n">p2</span><span class="p">())</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">p2</span><span class="p">())</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_b</span><span class="o">.</span><span class="n">p2</span><span class="p">())</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_a</span><span class="o">.</span><span class="n">p2</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">p1</span><span class="p">())</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">p2</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setPolygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

<div class="viewcode-block" id="QtEdge.connected_to"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtEdge.connected_to">[docs]</a>    <span class="k">def</span> <span class="nf">connected_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">QtNode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the other node along the edge.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: One of the edge&#39;s nodes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The other node (or None if edge doesn&#39;t have node).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span>
        <span class="k">elif</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="QtEdge.angle_to"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtEdge.angle_to">[docs]</a>    <span class="k">def</span> <span class="nf">angle_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">QtNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the angle from one edge node to the other.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node from which we&#39;re measuring the angle.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Angle (in radians) to the other node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span>
            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="QtEdge.updateEdge"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtEdge.updateEdge">[docs]</a>    <span class="k">def</span> <span class="nf">updateEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">QtNode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the visual display of node.</span>

<span class="sd">        Args:</span>
<span class="sd">            node: The node to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_opacity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_opacity</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">edges_shown</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_opacity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
            <span class="n">line</span><span class="o">.</span><span class="n">setP1</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
            <span class="n">line</span><span class="o">.</span><span class="n">setP2</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QtInstance"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance">[docs]</a><span class="k">class</span> <span class="nc">QtInstance</span><span class="p">(</span><span class="n">QGraphicsObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QGraphicsObject for skeleton instances.</span>

<span class="sd">    This object stores the data for one skeleton instance</span>
<span class="sd">    and handles the events to manipulate the skeleton within</span>
<span class="sd">    a video frame (i.e., moving, rotating, marking nodes).</span>

<span class="sd">    It should be instantiated with an `Instance` and added to the relevant</span>
<span class="sd">    `QGraphicsScene`.</span>

<span class="sd">    When instantiated, it creates `QtNode`, `QtEdge`, and</span>
<span class="sd">    `QtNodeLabel` items as children of itself.</span>

<span class="sd">    Args:</span>
<span class="sd">        instance: The :class:`Instance` to show.</span>
<span class="sd">        markerRadius: Radius of nodes.</span>
<span class="sd">        show_non_visible: Whether to show &quot;non-visible&quot; nodes/edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">player</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QtVideoPlayer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">markerRadius</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">show_non_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtInstance</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">skeleton</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">)</span>

        <span class="n">color_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">color_manager</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span> <span class="o">=</span> <span class="n">show_non_visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectable</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="ow">or</span> <span class="n">color_manager</span><span class="o">.</span><span class="n">color_predicted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerRadius</span> <span class="o">=</span> <span class="n">markerRadius</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges_shown</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_shown</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_rect</span> <span class="o">=</span> <span class="n">QRectF</span><span class="p">()</span>

        <span class="c1"># Show predicted instances behind non-predicted ones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Add box to go around instance for selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">QGraphicsRectItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">box_pen_width</span> <span class="o">=</span> <span class="n">color_manager</span><span class="o">.</span><span class="n">get_item_pen_width</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">box_pen</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">),</span> <span class="n">box_pen_width</span><span class="p">)</span>
        <span class="n">box_pen</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">DashLine</span><span class="p">)</span>
        <span class="n">box_pen</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">box_pen</span><span class="p">)</span>

        <span class="c1"># Add label for highlighted instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span> <span class="o">=</span> <span class="n">QtTextWithBackground</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;yellow&quot;</span><span class="p">))</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">font</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="c1"># Add box to go around instance for highlight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_box</span> <span class="o">=</span> <span class="n">QGraphicsRectItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">highlight_pen</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;yellow&quot;</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">highlight_pen</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_box</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">highlight_pen</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">track_label</span> <span class="o">=</span> <span class="n">QtTextWithBackground</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_label</span><span class="o">.</span><span class="n">setDefaultTextColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">))</span>

        <span class="n">instance_label_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">track</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">track_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">track</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">track_name</span> <span class="o">=</span> <span class="s2">&quot;[none]&quot;</span>
        <span class="n">instance_label_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;b&gt;Track&lt;/b&gt;: </span><span class="si">{</span><span class="n">track_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">):</span>
            <span class="n">instance_label_text</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&lt;br /&gt;&lt;b&gt;Prediction Score&lt;/b&gt;: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_label</span><span class="o">.</span><span class="n">setHtml</span><span class="p">(</span><span class="n">instance_label_text</span><span class="p">)</span>

        <span class="c1"># Add nodes</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">nodes_points</span><span class="p">:</span>
            <span class="n">node_item</span> <span class="o">=</span> <span class="n">QtNode</span><span class="p">(</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">player</span><span class="o">=</span><span class="n">player</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">point</span><span class="o">=</span><span class="n">point</span><span class="p">,</span>
                <span class="n">predicted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">,</span>
                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">markerRadius</span><span class="p">,</span>
                <span class="n">show_non_visible</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_item</span>

        <span class="c1"># Add edges</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">edge_names</span><span class="p">:</span>
            <span class="c1"># Make sure that both nodes are present in this instance before drawing edge</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="ow">and</span> <span class="n">dst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">edge_item</span> <span class="o">=</span> <span class="n">QtEdge</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">player</span><span class="o">=</span><span class="n">player</span><span class="p">,</span>
                    <span class="n">src</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">src</span><span class="p">],</span>
                    <span class="n">dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dst</span><span class="p">],</span>
                    <span class="n">show_non_visible</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_non_visible</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dst</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_item</span><span class="p">)</span>

        <span class="c1"># Add labels to nodes</span>
        <span class="c1"># We do this after adding edges so that we can position labels to avoid overlap</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">node_label</span> <span class="o">=</span> <span class="n">QtNodeLabel</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">predicted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">node_label</span><span class="o">.</span><span class="n">adjustPos</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_label</span>
                <span class="c1"># add callback to adjust position of label after node has moved</span>
                <span class="n">node</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_label</span><span class="o">.</span><span class="n">adjustPos</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateBox</span><span class="p">)</span>

        <span class="c1"># Update size of box so it includes all the nodes/edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateBox</span><span class="p">()</span>

<div class="viewcode-block" id="QtInstance.updatePoints"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.updatePoints">[docs]</a>    <span class="k">def</span> <span class="nf">updatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">user_change</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates data and display for all points in skeleton.</span>

<span class="sd">        This is called any time the skeleton is manipulated as a whole.</span>

<span class="sd">        Args:</span>
<span class="sd">            complete: Whether to update all nodes by setting &quot;completed&quot;</span>
<span class="sd">                attribute.</span>
<span class="sd">            user_change: Whether method is called because of change made by</span>
<span class="sd">                user.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Update the position for each node</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="n">user_change</span> <span class="ow">and</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">node_item</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">node_item</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span>
                    <span class="n">node_item</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">node_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">context</span><span class="o">.</span><span class="n">setPointLocations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node_item</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">node_item</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node_item</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">complete</span><span class="p">:</span>
                <span class="c1"># FIXME: move to command</span>
                <span class="n">node_item</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Wait to run callbacks until all nodes are updated</span>
        <span class="c1"># Otherwise the label positions aren&#39;t correct since</span>
        <span class="c1"># they depend on the edge vectors to old node positions.</span>
        <span class="k">for</span> <span class="n">node_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node_item</span><span class="o">.</span><span class="n">calls</span><span class="p">()</span>
        <span class="c1"># Reset the scene position and rotation (changes when we drag entire skeleton)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setRotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Update the position for each edge</span>
        <span class="k">for</span> <span class="n">edge_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">edge_item</span><span class="o">.</span><span class="n">updateEdge</span><span class="p">(</span><span class="n">edge_item</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>
            <span class="n">edge_item</span><span class="o">.</span><span class="n">updateEdge</span><span class="p">(</span><span class="n">edge_item</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>
        <span class="c1"># Update box for instance selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateBox</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtInstance.getPointsBoundingRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.getPointsBoundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">getPointsBoundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QRectF</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a rect which contains all the nodes in the skeleton.&quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">point</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">top_left</span> <span class="o">=</span> <span class="n">QPointF</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)),</span> <span class="nb">min</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">QPointF</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)),</span> <span class="nb">max</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">QRectF</span><span class="p">(</span><span class="n">top_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rect</span></div>

<div class="viewcode-block" id="QtInstance.updateBox"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.updateBox">[docs]</a>    <span class="k">def</span> <span class="nf">updateBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the box drawn around a selected skeleton.</span>

<span class="sd">        This updates both the box attribute stored and the visual box.</span>
<span class="sd">        The box attribute is used to determine whether a click should</span>
<span class="sd">        select this instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Only show box if instance is selected</span>
        <span class="n">op</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="c1"># Update the position for the box</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPointsBoundingRect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_rect</span> <span class="o">=</span> <span class="n">rect</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">marginsAdded</span><span class="p">(</span><span class="n">QMarginsF</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">setRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_label</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_label</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">()</span> <span class="o">+</span> <span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight_box</span><span class="o">.</span><span class="n">opacity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="nd">@highlight</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="k">if</span> <span class="n">val</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_box</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="c1"># Update the position for the box</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPointsBoundingRect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_rect</span> <span class="o">=</span> <span class="n">rect</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">marginsAdded</span><span class="p">(</span><span class="n">QMarginsF</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlight_box</span><span class="o">.</span><span class="n">setRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="c1"># Show label if highlight box isn&#39;t too small</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">op</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">topLeft</span><span class="p">()</span> <span class="o">-</span> <span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highlight_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@highlight_text</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">highlight_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_label</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether instance is selected.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span>

    <span class="nd">@selected</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets select-state for instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span> <span class="o">=</span> <span class="n">selected</span>
        <span class="c1"># Update the selection box for this skeleton instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateBox</span><span class="p">()</span>

<div class="viewcode-block" id="QtInstance.showLabels"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.showLabels">[docs]</a>    <span class="k">def</span> <span class="nf">showLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws/hides the labels for this skeleton instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            show: Show labels if True, hide them otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">show</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_shown</span> <span class="o">=</span> <span class="n">show</span></div>

<div class="viewcode-block" id="QtInstance.showEdges"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.showEdges">[docs]</a>    <span class="k">def</span> <span class="nf">showEdges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws/hides the edges for this skeleton instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            show: Show edges if True, hide them otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">full_opacity</span> <span class="k">if</span> <span class="n">show</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges_shown</span> <span class="o">=</span> <span class="n">show</span></div>

<div class="viewcode-block" id="QtInstance.boundingRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required Qt to determine bounding rect for item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounding_rect</span></div>

<div class="viewcode-block" id="QtInstance.paint"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtInstance.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required by Qt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="QtTextWithBackground"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtTextWithBackground">[docs]</a><span class="k">class</span> <span class="nc">QtTextWithBackground</span><span class="p">(</span><span class="n">QGraphicsTextItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherits methods/behavior of `QGraphicsTextItem`, but with background box.</span>

<span class="sd">    Color of background box is light or dark depending on the text color.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtTextWithBackground</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFlag</span><span class="p">(</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">ItemIgnoresTransformations</span><span class="p">)</span>

<div class="viewcode-block" id="QtTextWithBackground.boundingRect"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtTextWithBackground.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required by Qt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">QtTextWithBackground</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>

<div class="viewcode-block" id="QtTextWithBackground.paint"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.QtTextWithBackground.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method required by Qt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultTextColor</span><span class="p">()</span>
        <span class="n">brush</span> <span class="o">=</span> <span class="n">painter</span><span class="o">.</span><span class="n">brush</span><span class="p">()</span>
        <span class="n">background_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">text_color</span><span class="o">.</span><span class="n">lightnessF</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.4</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
        <span class="n">background_color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="n">background_color</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">QBrush</span><span class="p">(</span><span class="n">background_color</span><span class="p">))</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">drawRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="n">painter</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QtTextWithBackground</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="video_demo"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.video_demo">[docs]</a><span class="k">def</span> <span class="nf">video_demo</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">standalone</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Demo function for showing video.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">video</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">video</span><span class="p">:</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">standalone</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">QtVideoPlayer</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">window</span><span class="o">.</span><span class="n">changedPlot</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">vp</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">select_idx</span><span class="p">:</span> <span class="n">plot_instances</span><span class="p">(</span>
                <span class="n">vp</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">video</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">standalone</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_instances"><a class="viewcode-back" href="../../../../_autosummary/sleap.gui.widgets.video.html#sleap.gui.widgets.video.plot_instances">[docs]</a><span class="k">def</span> <span class="nf">plot_instances</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Demo function for plotting instances.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sleap.gui.color</span> <span class="kn">import</span> <span class="n">ColorManager</span>

    <span class="n">video</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">color_manager</span> <span class="o">=</span> <span class="n">ColorManager</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">lfs</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lfs</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">labeled_frame</span> <span class="o">=</span> <span class="n">lfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">count_no_track</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labeled_frame</span><span class="o">.</span><span class="n">instances_to_show</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">track</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="n">pseudo_track</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">track</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Instance without track</span>
            <span class="n">pseudo_track</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">+</span> <span class="n">count_no_track</span>
            <span class="n">count_no_track</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Plot instance</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">QtInstance</span><span class="p">(</span>
            <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_manager</span><span class="o">.</span><span class="n">get_track_color</span><span class="p">(</span><span class="n">pseudo_track</span><span class="p">),</span>
            <span class="n">predicted</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span>
            <span class="n">color_predicted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">show_non_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">showLabels</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">updatePoints</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="kn">from</span> <span class="nn">sleap.io.dataset</span> <span class="kn">import</span> <span class="n">Labels</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;data_path&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to labels json file&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">video_demo</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">SLEAP</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/reference.html">Feature Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;20192020, Murthy Lab @ Princeton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>