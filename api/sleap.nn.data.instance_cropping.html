
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>sleap.nn.data.instance_cropping &#8212; SLEAP (v1.2.8)</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="canonical" href="/develop/api/sleap.nn.data.instance_cropping.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">SLEAP (v1.2.8)</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Home
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/tutorial.html">
   Tutorial
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/new-project.html">
     Creating a project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/initial-labeling.html">
     Initial Labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/initial-training.html">
     Training and Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/assisted-labeling.html">
     Prediction-assisted labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/proofreading.html">
     Tracking instances across frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/analysis.html">
     Export Data For Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../guides/index.html">
   Guides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/gui.html">
     GUI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/cli.html">
     Command line interfaces
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/troubleshooting-workflows.html">
     Troubleshooting workflows
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/skeletons.html">
     Skeleton design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/choosing-models.html">
     Configuring models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/merging.html">
     Importing predictions for labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/proofreading.html">
     Tracking and proofreading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/colab.html">
     Run training and inference on Colab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/custom-training.html">
     Creating a custom training profile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../guides/remote.html">
     Running SLEAP remotely
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../notebooks/index.html">
   Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Training_and_inference_on_an_example_dataset.html">
     Training and inference on an example dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Training_and_inference_using_Google_Drive.html">
     Training and inference on your own data using Google Drive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Model_evaluation.html">
     Model evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Analysis_examples.html">
     Analysis examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Data_structures.html">
     Data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Post_inference_tracking.html">
     Post-inference tracking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Interactive_and_resumable_training.html">
     Interactive and resumable training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/Interactive_and_realtime_inference.html">
     Interactive and realtime inference
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api.html">
   Developer API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../datasets.html">
   Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/talmolab/sleap">
   GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/talmolab/sleap/releases">
   Releases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../help.html">
   Help
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/talmolab/sleap"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/talmolab/sleap/issues/new?title=Issue%20on%20page%20%2Fapi/sleap.nn.data.instance_cropping.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>sleap.nn.data.instance_cropping</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="module-sleap.nn.data.instance_cropping">
<span id="sleap-nn-data-instance-cropping"></span><h1>sleap.nn.data.instance_cropping<a class="headerlink" href="#module-sleap.nn.data.instance_cropping" title="Permalink to this headline">#</a></h1>
<p>Transformers for cropping instances for topdown processing.</p>
<dl class="py class">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">InstanceCropper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">crop_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crop_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_full_image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mock_centroid_confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unbatch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'image'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instances_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'instances'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centroids_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'centroids'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L225-L458"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper" title="Permalink to this definition">#</a></dt>
<dd><p>Data transformer to crop and generate individual examples for instances.</p>
<p>This generates datasets that are instance cropped for topdown processing.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.crop_width">
<span class="sig-name descname"><span class="pre">crop_width</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.crop_width" title="Permalink to this definition">#</a></dt>
<dd><p>Width of the crops in pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.crop_height">
<span class="sig-name descname"><span class="pre">crop_height</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.crop_height" title="Permalink to this definition">#</a></dt>
<dd><p>Height of the crops in pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.keep_full_image">
<span class="sig-name descname"><span class="pre">keep_full_image</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.keep_full_image" title="Permalink to this definition">#</a></dt>
<dd><p>If True, the output examples will contain the full images
provided as input to the instance cropped. This can be useful for pipelines
that use both full and cropped images, at the cost of increased memory
requirements usage. Setting this to False can substantially improve
performance of large pipelines if the full images are no longer required.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.mock_centroid_confidence">
<span class="sig-name descname"><span class="pre">mock_centroid_confidence</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.mock_centroid_confidence" title="Permalink to this definition">#</a></dt>
<dd><p>If True, add confidence keys for compatibility with
predicted instance cropping.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.unbatch">
<span class="sig-name descname"><span class="pre">unbatch</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.unbatch" title="Permalink to this definition">#</a></dt>
<dd><p>If True (the default), split frame-level examples into multiple
instance-level examples. If False, all instance crops will be kept within
the same example. Use this when building pipelines that require knowledge
about all instances within a single example.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.image_key">
<span class="sig-name descname"><span class="pre">image_key</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.image_key" title="Permalink to this definition">#</a></dt>
<dd><p>Name of the example key where the image is stored. Defaults to
“image”.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.instances_key">
<span class="sig-name descname"><span class="pre">instances_key</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.instances_key" title="Permalink to this definition">#</a></dt>
<dd><p>Name of the example key where the instance points are stored.
Defaults to “instances”.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.centroids_key">
<span class="sig-name descname"><span class="pre">centroids_key</span></span><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.centroids_key" title="Permalink to this definition">#</a></dt>
<dd><p>Name of the example key where the instance centroids are stored.
Defaults to “centroids”.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.from_config">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="sleap.nn.config.data.html#sleap.nn.config.data.InstanceCroppingConfig" title="sleap.nn.config.data.InstanceCroppingConfig"><span class="pre">sleap.nn.config.data.InstanceCroppingConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">crop_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sleap.nn.data.instance_cropping.InstanceCropper" title="sleap.nn.data.instance_cropping.InstanceCropper"><span class="pre">sleap.nn.data.instance_cropping.InstanceCropper</span></a></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L261-L288"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.from_config" title="Permalink to this definition">#</a></dt>
<dd><p>Build an instance of this class from its configuration options.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – An <code class="xref py py-obj docutils literal notranslate"><span class="pre">InstanceCroppingConfig</span></code> instance with the desired parameters.</p></li>
<li><p><strong>crop_size</strong> – Integer specifying the crop height and width. This is only
required and will only be used if the <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.crop_size</span></code> attribute does
not specify an explicit integer crop size (e.g., it is set to None).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of this class.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the <code class="xref py py-obj docutils literal notranslate"><span class="pre">crop_size</span></code> is not specified in either the config
    attribute or function arguments.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.input_keys">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_keys</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.input_keys" title="Permalink to this definition">#</a></dt>
<dd><p>Return the keys that incoming elements are expected to have.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.output_keys">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output_keys</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.output_keys" title="Permalink to this definition">#</a></dt>
<dd><p>Return the keys that outgoing elements will have.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.InstanceCropper.transform_dataset">
<span class="sig-name descname"><span class="pre">transform_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.data.ops.dataset_ops.DatasetV2</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.data.ops.dataset_ops.DatasetV2</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L315-L458"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.InstanceCropper.transform_dataset" title="Permalink to this definition">#</a></dt>
<dd><p>Create a dataset that contains instance cropped data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ds_input</strong> – <p>A dataset with examples containing the following keys:
“image”: The full image in a tensor of shape (height, width, channels).
“instances”: Instance points in a tf.float32 tensor of shape</p>
<blockquote>
<div><p>(n_instances, n_nodes, 2).</p>
</div></blockquote>
<dl class="simple">
<dt>”centroids”: The computed centroid for each instance in a tf.float32</dt><dd><p>tensor of shape (n_instances, 2).</p>
</dd>
</dl>
<p>”track_inds”: The track indices of the indices if available.
Any additional keys present will be replicated in each output.</p>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code> with elements containing instance cropped data. Each
instance will generate an example, so the total number of elements may
change relative to the input dataset.</p>
<dl>
<dt>Each element in the output dataset will have the following keys:</dt><dd><dl class="simple">
<dt>”instance_image”: A cropped image of the same dtype as the input image</dt><dd><p>but with shape (crop_width, crop_height, channels) and will be
centered on an instance.</p>
</dd>
<dt>”bbox”: The bounding box in absolute image coordinates in the format</dt><dd><p>(y1, x1, y2, x2) that resulted in the cropped image in
“instance_image”. This will be a tf.float32 tensor of shape (4,).</p>
</dd>
<dt>”center_instance”: The points of the centered instance in image</dt><dd><p>coordinates in the “instance_image”. This will be a tf.float32
tensor of shape (n_nodes, 2). The absolute image coordinates can be
recovered by adding (x1, y1) from the “bbox” key.</p>
</dd>
<dt>”center_instance_ind”: Scalar tf.int32 index of the centered instance</dt><dd><p>relative to all the instances in the frame. This can be used to
index into additional keys that may contain data from all instances.</p>
</dd>
</dl>
<p>”track_ind”: Index of the track the instance belongs to if available.
“all_instances”: The points of all instances in the frame in image</p>
<blockquote>
<div><p>coordinates in the “instance_image”. This will be a tf.float32
tensor of shape (n_instances, n_nodes, 2). This is useful for multi-
stage models that first predict all nodes and subsequently refine it
to just the centered instance. The “center_instance_ind”-th row of
this tensor is equal to “center_instance”.</p>
</div></blockquote>
<dl class="simple">
<dt>”centroid”: The centroid coordinate that was used to generate this crop,</dt><dd><p>specified as a tf.float32 tensor of shape (2,) in absolute image
coordinates.</p>
</dd>
<dt>”full_image_height”: The height of the full image from which the crop</dt><dd><p>was generated, specified as a scalar tf.int32 tensor.</p>
</dd>
<dt>”full_image_width”: The width of the full image from which the crop was</dt><dd><p>generated, specified as a scalar tf.int32 tensor.</p>
</dd>
</dl>
</dd>
</dl>
<p>If <a class="reference internal" href="#sleap.nn.data.instance_cropping.InstanceCropper.keep_full_image" title="sleap.nn.data.instance_cropping.InstanceCropper.keep_full_image"><code class="xref py py-obj docutils literal notranslate"><span class="pre">keep_full_image</span></code></a> is True, examples will also have an “image” key
containing the same image as the input.</p>
<p>if <a class="reference internal" href="#sleap.nn.data.instance_cropping.InstanceCropper.mock_centroid_confidence" title="sleap.nn.data.instance_cropping.InstanceCropper.mock_centroid_confidence"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mock_centroid_confidence</span></code></a> is True, examples will also have a
“centroid_confidence” key with all ones. This is useful for evaluating
models that use crops independently from centroid inference.</p>
<p>Additional keys will be replicated in each example under the same name.</p>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.crop_bboxes">
<span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">crop_bboxes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bboxes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L169-L221"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.crop_bboxes" title="Permalink to this definition">#</a></dt>
<dd><p>Crop bounding boxes from an image.</p>
<p>This method serves as a convenience method for specifying the arguments of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.image.crop_and_resize</span></code>, becoming especially useful in the case of multiple
bounding boxes with a single image and no resizing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – Tensor of shape (height, width, channels) of a single image.</p></li>
<li><p><strong>bboxes</strong> – Tensor of shape (n_bboxes, 4) and dtype tf.float32, where the last axis
corresponds to (y1, x1, y2, x2) coordinates of the bounding boxes. This can
be generated from centroids using <a class="reference internal" href="#sleap.nn.data.instance_cropping.make_centered_bboxes" title="sleap.nn.data.instance_cropping.make_centered_bboxes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_centered_bboxes</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor of shape (n_bboxes, crop_height, crop_width, channels) of the same
dtype as the input image. The crop size is inferred from the bounding box
coordinates.</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This function expects bounding boxes with coordinates at the centers of the
pixels in the box limits. Technically, the box will span (x1 - 0.5, x2 + 0.5)
and (y1 - 0.5, y2 + 0.5).</p>
<p>For example, a 3x3 patch centered at (1, 1) would be specified by
(y1, x1, y2, x2) = (0, 0, 2, 2). This would be exactly equivalent to indexing
the image with <code class="xref py py-obj docutils literal notranslate"><span class="pre">image[0:3,</span> <span class="pre">0:3]</span></code>.</p>
</div>
<p>See also: <a class="reference internal" href="#sleap.nn.data.instance_cropping.make_centered_bboxes" title="sleap.nn.data.instance_cropping.make_centered_bboxes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_centered_bboxes</span></code></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.find_instance_crop_size">
<span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">find_instance_crop_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="sleap.io.dataset.html#sleap.io.dataset.Labels" title="sleap.io.dataset.Labels"><span class="pre">sleap.io.dataset.Labels</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maximum_stride</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_scaling</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_crop_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L11-L55"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.find_instance_crop_size" title="Permalink to this definition">#</a></dt>
<dd><p>Compute the size of the largest instance bounding box from labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">sleap.Labels</span></code> containing user-labeled instances.</p></li>
<li><p><strong>padding</strong> – Integer number of pixels to add to the bounds as margin padding.</p></li>
<li><p><strong>maximum_stride</strong> – Ensure that the returned crop size is divisible by this value.
Useful for ensuring that the crop size will not be truncated in a given
architecture.</p></li>
<li><p><strong>input_scaling</strong> – Float factor indicating the scale of the input images if any
scaling will be done before cropping.</p></li>
<li><p><strong>min_crop_size</strong> – The (optional) crop size set by the user. None if not set.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>An integer crop size denoting the length of the side of the bounding boxes that
will contain the instances when cropped. The returned crop size will be larger
or equal to the input <code class="xref py py-obj docutils literal notranslate"><span class="pre">crop_size</span></code>.</p>
<p>This accounts for stride, padding and scaling when ensuring divisibility.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.make_centered_bboxes">
<span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">make_centered_bboxes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centroids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L124-L166"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.make_centered_bboxes" title="Permalink to this definition">#</a></dt>
<dd><p>Generate bounding boxes centered on a set of centroid coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centroids</strong> – A tensor of shape (n_centroids, 2) and dtype tf.float32, where the
last axis corresponds to the (x, y) coordinates of each centroid.</p></li>
<li><p><strong>box_height</strong> – Scalar integer indicating the height of the bounding boxes.</p></li>
<li><p><strong>box_width</strong> – Scalar integer indicating the width of the bounding boxes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tensor of shape (n_centroids, 4) and dtype tf.float32, where the last axis
corresponds to (y1, x1, y2, x2) coordinates of the bounding boxes in absolute
image coordinates.</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The bounding box coordinates are calculated such that the centroid coordinates
map onto the center of the pixel. For example:</p>
<p>For a single row image of shape (1, 4) with values: <code class="xref py py-obj docutils literal notranslate"><span class="pre">[[a,</span> <span class="pre">b,</span> <span class="pre">c,</span> <span class="pre">d]]</span></code>, the x
coordinates can be visualized in the diagram below:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div></div></blockquote>
<div class="line-block">
<div class="line">a  |  b  |  c  |  d  |</div>
<div class="line">|  |  |  |  |  |  |  |</div>
</div>
</div></blockquote>
<dl class="simple">
<dt>-0.5 | 0.5 | 1.5 | 2.5 | 3.5</dt><dd><p>0     1     2     3</p>
</dd>
</dl>
</div></blockquote>
<p>To get a (1, 3) patch centered at c, the centroid would be at (x, y) = (2, 0)
with box height of 1 and box width of 3, to yield <code class="xref py py-obj docutils literal notranslate"><span class="pre">[[b,</span> <span class="pre">c,</span> <span class="pre">d]]</span></code>.</p>
<p>For even sized bounding boxes, e.g., to get the center 2 elements, the centroid
would be at (x, y) = (1.5, 0) with box width of 2, to yield <code class="xref py py-obj docutils literal notranslate"><span class="pre">[[b,</span> <span class="pre">c]]</span></code>.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.normalize_bboxes">
<span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">normalize_bboxes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bboxes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L58-L90"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.normalize_bboxes" title="Permalink to this definition">#</a></dt>
<dd><p>Normalize bounding box coordinates to the range [0, 1].</p>
<p>This is useful for transforming points for TensorFlow operations that require
normalized image coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bboxes</strong> – Tensor of shape (n_bboxes, 4) and dtype tf.float32, where the last axis
corresponds to (y1, x1, y2, x2) coordinates of the bounding boxes.</p></li>
<li><p><strong>image_height</strong> – Scalar integer indicating the height of the image.</p></li>
<li><p><strong>image_width</strong> – Scalar integer indicating the width of the image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Tensor of the normalized points of the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">bboxes</span></code>.</p>
<p>The normalization applied to each point is <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">(image_width</span> <span class="pre">-</span> <span class="pre">1)</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">y</span> <span class="pre">/</span> <span class="pre">(image_width</span> <span class="pre">-</span> <span class="pre">1)</span></code>.</p>
</p>
</dd>
</dl>
<p>See also: unnormalize_bboxes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sleap.nn.data.instance_cropping.unnormalize_bboxes">
<span class="sig-prename descclassname"><span class="pre">sleap.nn.data.instance_cropping.</span></span><span class="sig-name descname"><span class="pre">unnormalize_bboxes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalized_bboxes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference external" href="https://github.com/talmolab/sleap/blob/v1.2.8/sleap/nn/data/instance_cropping.py#L93-L121"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sleap.nn.data.instance_cropping.unnormalize_bboxes" title="Permalink to this definition">#</a></dt>
<dd><p>Convert bounding boxes coordinates in the range [0, 1] to absolute coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>normalized_bboxes</strong> – Tensor of shape (n_bboxes, 4) and dtype tf.float32, where the
last axis corresponds to (y1, x1, y2, x2) normalized coordinates of the
bounding boxes in the range [0, 1].</p></li>
<li><p><strong>image_height</strong> – Scalar integer indicating the height of the image.</p></li>
<li><p><strong>image_width</strong> – Scalar integer indicating the width of the image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tensor of the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">bboxes</span></code> mapped back to absolute image coordinates
by multiplying (x, y) coordinates by <code class="xref py py-obj docutils literal notranslate"><span class="pre">(image_width</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">image_height</span> <span class="pre">-</span> <span class="pre">1)</span></code>.</p>
</dd>
</dl>
<p>See also: normalize_bboxes</p>
</dd></dl>

</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By SLEAP Developers<br/>
  
      &copy; Copyright 2019–2022, Talmo Lab.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>