<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Analysis examples" href="Analysis_examples.html" /><link rel="prev" title="Training and inference on your own data using Google Drive" href="Training_and_inference_using_Google_Drive.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><meta name="generator" content="sphinx-3.5.4, furo 2021.06.18.beta36"/>
        <title>Model evaluation - SLEAP (v1.1.4)</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=9b17055c4366e8b2949c66d6a9d8b0efe4dbaa60">
    <link rel="stylesheet" href="../_static/pygments.css">
    


<style>
  :root {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
</style><link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    <link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=ee12cdd73c4bbac24afec78d92c4afd7c2d8ea7f"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SLEAP (v1.1.4)</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/logo.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/logo.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">SLEAP (v1.1.4)</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/tutorial.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/new-project.html">Creating a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/initial-labeling.html">Initial Labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/initial-training.html">Training and Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/assisted-labeling.html">Prediction-assisted labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/assisted-labeling.html#reviewing-and-fixing-predictions">Reviewing and fixing predictions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/proofreading.html">Tracking instances across frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/analysis.html">Export Data For Analysis</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/gui.html">GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/cli.html">Command line interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/skeletons.html">Skeleton design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/choosing-models.html">Choosing a set of models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/merging.html">Importing predictions for labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/proofreading.html">Tracking and proofreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/colab.html">Run training and inference on Colab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/custom-training.html">Creating a custom training profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/remote.html">Running SLEAP remotely</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Notebooks</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Training_and_inference_on_an_example_dataset.html">Training and inference on an example dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="Training_and_inference_using_Google_Drive.html">Training and inference on your own data using Google Drive</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Model evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Analysis_examples.html">Analysis examples</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">Developer API</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.instance.html">sleap.instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.message.html">sleap.message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.skeleton.html">sleap.skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.util.html">sleap.util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.asyncvideo.html">sleap.io.asyncvideo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.convert.html">sleap.io.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.dataset.html">sleap.io.dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.legacy.html">sleap.io.legacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.pathutils.html">sleap.io.pathutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.video.html">sleap.io.video</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.videowriter.html">sleap.io.videowriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.visuals.html">sleap.io.visuals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.adaptor.html">sleap.io.format.adaptor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.coco.html">sleap.io.format.coco</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.deeplabcut.html">sleap.io.format.deeplabcut</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.deepposekit.html">sleap.io.format.deepposekit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.dispatch.html">sleap.io.format.dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.filehandle.html">sleap.io.format.filehandle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.genericjson.html">sleap.io.format.genericjson</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.hdf5.html">sleap.io.format.hdf5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.labels_json.html">sleap.io.format.labels_json</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.leap_matlab.html">sleap.io.format.leap_matlab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.main.html">sleap.io.format.main</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.sleap_analysis.html">sleap.io.format.sleap_analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.io.format.text.html">sleap.io.format.text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.align.html">sleap.info.align</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.feature_suggestions.html">sleap.info.feature_suggestions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.labels.html">sleap.info.labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.metrics.html">sleap.info.metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.summary.html">sleap.info.summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.trackcleaner.html">sleap.info.trackcleaner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.info.write_tracking_h5.html">sleap.info.write_tracking_h5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.callbacks.html">sleap.nn.callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.evals.html">sleap.nn.evals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.heads.html">sleap.nn.heads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.inference.html">sleap.nn.inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.losses.html">sleap.nn.losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.model.html">sleap.nn.model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.monitor.html">sleap.nn.monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.paf_grouping.html">sleap.nn.paf_grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.peak_finding.html">sleap.nn.peak_finding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.system.html">sleap.nn.system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.tracking.html">sleap.nn.tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.training.html">sleap.nn.training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.utils.html">sleap.nn.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.viz.html">sleap.nn.viz</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.common.html">sleap.nn.architectures.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.encoder_decoder.html">sleap.nn.architectures.encoder_decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.hourglass.html">sleap.nn.architectures.hourglass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.hrnet.html">sleap.nn.architectures.hrnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.leap.html">sleap.nn.architectures.leap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.pretrained_encoders.html">sleap.nn.architectures.pretrained_encoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.resnet.html">sleap.nn.architectures.resnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.unet.html">sleap.nn.architectures.unet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.architectures.upsampling.html">sleap.nn.architectures.upsampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.tracker.components.html">sleap.nn.tracker.components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.tracker.kalman.html">sleap.nn.tracker.kalman</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.data.html">sleap.nn.config.data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.model.html">sleap.nn.config.model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.optimization.html">sleap.nn.config.optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.outputs.html">sleap.nn.config.outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.training_job.html">sleap.nn.config.training_job</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.config.utils.html">sleap.nn.config.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.augmentation.html">sleap.nn.data.augmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.confidence_maps.html">sleap.nn.data.confidence_maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.dataset_ops.html">sleap.nn.data.dataset_ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.edge_maps.html">sleap.nn.data.edge_maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.general.html">sleap.nn.data.general</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.grouping.html">sleap.nn.data.grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.inference.html">sleap.nn.data.inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.instance_centroids.html">sleap.nn.data.instance_centroids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.instance_cropping.html">sleap.nn.data.instance_cropping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.normalization.html">sleap.nn.data.normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.offset_regression.html">sleap.nn.data.offset_regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.pipelines.html">sleap.nn.data.pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.providers.html">sleap.nn.data.providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.resizing.html">sleap.nn.data.resizing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.training.html">sleap.nn.data.training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sleap.nn.data.utils.html">sleap.nn.data.utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/murthylab/sleap-datasets">Sample datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/murthylab/sleap">Source code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/murthylab/sleap/releases">Releases</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="model-evaluation">
<h1>Model evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this headline">¶</a></h1>
<p>After you’ve trained several models, you may want to generate some accuracy metrics to compare between them. This notebook demonstrates how you’ll do that given a trained model.</p>
<p>Let’s start by installing SLEAP and downloading the trained model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install sleap
!apt install tree &gt; /dev/null 2&gt;&amp;1
!wget https://storage.googleapis.com/sleap-data/reference/flies13/td_fast.210505_012601.centered_instance.n%3D1800.zip &gt; /dev/null 2&gt;&amp;1
!unzip -o -d "td_fast.210505_012601.centered_instance.n=1800" "td_fast.210505_012601.centered_instance.n=1800.zip" &gt; /dev/null 2&gt;&amp;1
</pre></div>
</div>
</div>
</div>
<p>A trained SLEAP model will be a folder containing files that specify metadata that is useful for evaluation and analysis. The exact set of files may depend on the configuration, but all models will come with:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metrics.train.npz</span></code>: Metrics for the training split.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metrics.val.npz</span></code>: Metrics for the validation split. This is what you’ll want to use most of the time since it wasn’t directly used for optimizing the model.</p></li>
</ul>
<p><strong>Note:</strong> A test split will also be evaluated if it was provided during training and saved to <code class="docutils literal notranslate"><span class="pre">metrics.test.npz</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!tree td_fast.210505_012601.centered_instance.n=1800
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>td_fast.210505_012601.centered_instance.n=1800
├── best_model.h5
├── initial_config.json
├── labels_gt.test.slp
├── labels_gt.train.slp
├── labels_gt.val.slp
├── labels_pr.test.slp
├── labels_pr.train.slp
├── labels_pr.val.slp
├── labels_pr.with_centroid.test.slp
├── metrics.test.npz
├── metrics.train.npz
├── metrics.val.npz
├── metrics.with_centroid.test.npz
├── model_info.json
├── training_config.json
└── training_log.csv

0 directories, 16 files
</pre></div>
</div>
</div>
</div>
<p>Additionally, the following files are included and may also be useful:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">best_model.h5</span></code>: The actual saved model and weights. This can be loaded with <code class="docutils literal notranslate"><span class="pre">tf.keras.model.load_model()</span></code> but it is recommended to use <code class="docutils literal notranslate"><span class="pre">sleap.load_model()</span></code> instead as it takes care of adding some additional inference-only procedures.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">training_config.json</span></code>: The configuration for the model training job, including metadata inferred during the training procedure. It can be loaded with <code class="docutils literal notranslate"><span class="pre">sleap.load_config()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels_gt.train.slp</span></code> and <code class="docutils literal notranslate"><span class="pre">labels_pr.train.slp</span></code>: These are SLEAP labels files containing the ground truth and predicted points for the training split. They do not contain the images, but can be used to retrieve the poses used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels_gt.train.slp</span></code> and <code class="docutils literal notranslate"><span class="pre">labels_pr.train.slp</span></code>: These are SLEAP labels files containing the ground truth and predicted points for the validation split. They do not contain the images, but can be used to retrieve the poses used.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sleap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">"seaborn-deep"</span><span class="p">)</span>
<span class="n">sleap</span><span class="o">.</span><span class="n">versions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SLEAP: 1.1.4
TensorFlow: 2.3.1
Numpy: 1.19.5
Python: 3.7.11
OS: Linux-5.4.104+-x86_64-with-Ubuntu-18.04-bionic
</pre></div>
</div>
</div>
</div>
<p>SLEAP metrics can be loaded using the <code class="docutils literal notranslate"><span class="pre">sleap.load_metrics()</span></code> API:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">sleap</span><span class="o">.</span><span class="n">load_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function load_metrics in module sleap.nn.evals:

load_metrics(model_path: str, split: str = 'val') -&gt; typing.Dict[str, typing.Any]
    Load metrics for a model.
    
    Args:
        model_path: Path to a model folder.
        split: Name of the split to load the metrics for. Must be `"train"`, `"val"` or
            `"test"` (default: `"val"`).
    
    Returns:
        The loaded metrics as a dictionary with keys:
    
        - `"vis.tp"`: Visibility - True Positives
        - `"vis.fp"`: Visibility - False Positives
        - `"vis.tn"`: Visibility - True Negatives
        - `"vis.fn"`: Visibility - False Negatives
        - `"vis.precision"`: Visibility - Precision
        - `"vis.recall"`: Visibility - Recall
        - `"dist.avg"`: Average Distance (ground truth vs prediction)
        - `"dist.p50"`: Distance for 50th percentile
        - `"dist.p75"`: Distance for 75th percentile
        - `"dist.p90"`: Distance for 90th percentile
        - `"dist.p95"`: Distance for 95th percentile
        - `"dist.p99"`: Distance for 99th percentile
        - `"dist.dists"`: All distances
        - `"pck.mPCK"`: Mean Percentage of Correct Keypoints (PCK)
        - `"oks.mOKS"`: Mean Object Keypoint Similarity (OKS)
        - `"oks_voc.mAP"`: VOC with OKS scores - mean Average Precision (mAP)
        - `"oks_voc.mAR"`: VOC with OKS scores - mean Average Recall (mAR)
        - `"pck_voc.mAP"`: VOC with PCK scores - mean Average Precision (mAP)
        - `"pck_voc.mAR"`: VOC with PCK scores - mean Average Recall (mAR)
</pre></div>
</div>
</div>
</div>
<p>Loading the metrics for the validation split of the model we can see all of the available keys:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span> <span class="o">=</span> <span class="n">sleap</span><span class="o">.</span><span class="n">load_metrics</span><span class="p">(</span><span class="s2">"td_fast.210505_012601.centered_instance.n=1800"</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">"val"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vis.tp
vis.fp
vis.tn
vis.fn
vis.precision
vis.recall
dist.dists
dist.avg
dist.p50
dist.p75
dist.p90
dist.p95
dist.p99
pck.thresholds
pck.pcks
pck.mPCK_parts
pck.mPCK
oks.mOKS
oks_voc.match_score_thresholds
oks_voc.recall_thresholds
oks_voc.match_scores
oks_voc.precisions
oks_voc.recalls
oks_voc.AP
oks_voc.AR
oks_voc.mAP
oks_voc.mAR
pck_voc.match_score_thresholds
pck_voc.recall_thresholds
pck_voc.match_scores
pck_voc.precisions
pck_voc.recalls
pck_voc.AP
pck_voc.AR
pck_voc.mAP
pck_voc.mAR
</pre></div>
</div>
</div>
</div>
<p>To start, let’s look at the summary of the <strong>localization errors</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (50%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p50"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (90%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p90"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (95%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p95"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error distance (50%): 0.9010142093245521
Error distance (90%): 2.0545800141197903
Error distance (95%): 3.0166608700891056
</pre></div>
</div>
</div>
</div>
<p>These are the percentiles of the distribution of how far off the model was from the ground truth location.</p>
<p>We can visualize the entire distribution like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.dists"</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">binrange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">"clip"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)},</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"probability"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Localization error (px)"</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:numexpr.utils:NumExpr defaulting to 2 threads.
</pre></div>
</div>
<img alt="../_images/Model_evaluation_13_1.png" src="../_images/Model_evaluation_13_1.png"/>
</div>
</div>
<p>This metric is intuitive, but it does not incorporate other sources of error like those stemming from poor instance detection and grouping, or missing points.</p>
<p>The Object Keypoint Similarity (OKS) is a more holistic metric that takes factors such as landmark visibility, animal size, and the difficulty in locating keypoints (all are assumed to be “easy” for our calculations). You can read more about this and other pose estimation metrics in: https://arxiv.org/abs/1707.05388</p>
<p>First let’s plot the distribution of OKS scores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.match_scores"</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">binrange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">"clip"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"probability"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Object Keypoint Similarity"</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Model_evaluation_15_0.png" src="../_images/Model_evaluation_15_0.png"/>
</div>
</div>
<p>Since these range from 0 to 1, it seems like we’re doing pretty well!</p>
<p>Another way to summarize this is through precision-recall curves, which evaluate how well the model does at different thresholds of OKS scores. The higher the threshold, the more stringent our criteria for classifying a prediction as correct.</p>
<p>Here we plot this at different thresholds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="k">for</span> <span class="n">precision</span><span class="p">,</span> <span class="n">thresh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.precisions"</span><span class="p">][::</span><span class="mi">2</span><span class="p">],</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.match_score_thresholds"</span><span class="p">][::</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.recall_thresholds"</span><span class="p">],</span> <span class="n">precision</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">"OKS @ </span><span class="si">{</span><span class="n">thresh</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Recall"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Precision"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">"lower left"</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Model_evaluation_17_0.png" src="../_images/Model_evaluation_17_0.png"/>
</div>
</div>
<p>An easy way to summarize this analysis is to take the average over all of these thresholds to compute the <strong>mean Average Precision (mAP)</strong> and <strong>mean Average Recall (mAR)</strong> which are widely used in the pose estimation literature.</p>
<p>Here are those values saved out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"mAP:"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.mAP"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"mAR:"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.mAR"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mAP: 0.8150621709973537
mAR: 0.8885
</pre></div>
</div>
</div>
</div>
<p>Great, but what if we have some new labels or want to evaluate the model with an updated set of labels for better comparisons with newer models?</p>
<p>For this, we’ll need to generate new predictions.</p>
<p>First, let’s download a new SLEAP labels package file (<code class="docutils literal notranslate"><span class="pre">.pkg.slp</span></code>). This is important since it denotes that the labels contain the images as well which we need for predicting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!wget https://storage.googleapis.com/sleap-data/datasets/wt_gold.13pt/tracking_split2/test.pkg.slp &gt; /dev/null 2&gt;&amp;1
</pre></div>
</div>
</div>
</div>
<p>Next we can simply load the model, the ground truth (GT) labels, and generate the predictions (~1 min on CPU):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span> <span class="o">=</span> <span class="n">sleap</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">"td_fast.210505_012601.centered_instance.n=1800"</span><span class="p">)</span>
<span class="n">labels_gt</span> <span class="o">=</span> <span class="n">sleap</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="s2">"test.pkg.slp"</span><span class="p">)</span>
<span class="n">labels_pr</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">labels_gt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Generating another set of metrics can then be calculated with the pair of GT and predicted labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span> <span class="o">=</span> <span class="n">sleap</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">labels_gt</span><span class="p">,</span> <span class="n">labels_pr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (50%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p50"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (90%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p90"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Error distance (95%):"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"dist.p95"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"mAP:"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.mAP"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"mAR:"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">"oks_voc.mAR"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error distance (50%): 0.8984147543126978
Error distance (90%): 2.197896466395166
Error distance (95%): 3.148422807907632
mAP: 0.797836431061851
mAR: 0.8782499999999999
</pre></div>
</div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Analysis_examples.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Analysis examples</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Training_and_inference_using_Google_Drive.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Training and inference on your own data using Google Drive</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019–2021, Murthy Lab @ Princeton University
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/notebooks/Model_evaluation.ipynb.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>